{"ast":null,"code":"import { BcmsComponent } from '@feat/common/bcms.component';\nimport { Evaluation } from '../evaluation.class';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@system/system.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../evaluation.service\";\nimport * as i4 from \"@feat/quest/question.service\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../../core/footer/footer.component\";\nimport * as i8 from \"../../../core/menu/menu.component\";\nimport * as i9 from \"../../utility/dsi-countdown-timer/dsi-countdown-timer.component\";\n\nfunction EvaluationTakeComponent_table_6_span_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\")(1, \"input\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function EvaluationTakeComponent_table_6_span_24_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.ans = $event);\n    })(\"click\", function EvaluationTakeComponent_table_6_span_24_Template_input_click_1_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.registerAnswer(2));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.ans)(\"value\", 2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.question.answerTextC, \" \");\n  }\n}\n\nfunction EvaluationTakeComponent_table_6_span_28_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\")(1, \"input\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function EvaluationTakeComponent_table_6_span_28_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.ans = $event);\n    })(\"click\", function EvaluationTakeComponent_table_6_span_28_Template_input_click_1_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r10.registerAnswer(3));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.ans)(\"value\", 3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.question.answerTextD, \" \");\n  }\n}\n\nfunction EvaluationTakeComponent_table_6_span_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\")(1, \"input\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function EvaluationTakeComponent_table_6_span_32_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.ans = $event);\n    })(\"click\", function EvaluationTakeComponent_table_6_span_32_Template_input_click_1_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r13.registerAnswer(4));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r3.ans)(\"value\", 4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.question.answerTextE, \" \");\n  }\n}\n\nfunction EvaluationTakeComponent_table_6_td_44_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\")(1, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function EvaluationTakeComponent_table_6_td_44_span_1_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r15.done());\n    });\n    i0.ɵɵtext(2, \"Verify Done If Finished\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" | | \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction EvaluationTakeComponent_table_6_td_44_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\", 14);\n    i0.ɵɵtemplate(1, EvaluationTakeComponent_table_6_td_44_span_1_Template, 4, 0, \"span\", 10);\n    i0.ɵɵelementStart(2, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function EvaluationTakeComponent_table_6_td_44_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r17.finished());\n    });\n    i0.ɵɵtext(3, \"Done\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.verifyDone);\n  }\n}\n\nfunction EvaluationTakeComponent_table_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"table\", 2)(1, \"tr\")(2, \"td\", 3);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\", 4)(5, \"span\", 5);\n    i0.ɵɵtext(6, \" [ Time remaining: \");\n    i0.ɵɵelementStart(7, \"dsi-countdown-timer\", 6);\n    i0.ɵɵlistener(\"timerExpiredEvent\", function EvaluationTakeComponent_table_6_Template_dsi_countdown_timer_timerExpiredEvent_7_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.handleTimerExpiredEvent());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8, \" ] \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"span\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"tr\")(12, \"td\", 7);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"tr\")(15, \"td\", 8)(16, \"input\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function EvaluationTakeComponent_table_6_Template_input_ngModelChange_16_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r21 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r21.ans = $event);\n    })(\"click\", function EvaluationTakeComponent_table_6_Template_input_click_16_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.registerAnswer(0));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"tr\")(19, \"td\")(20, \"input\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function EvaluationTakeComponent_table_6_Template_input_ngModelChange_20_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r23 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r23.ans = $event);\n    })(\"click\", function EvaluationTakeComponent_table_6_Template_input_click_20_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r24 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r24.registerAnswer(1));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"tr\")(23, \"td\", 8);\n    i0.ɵɵtemplate(24, EvaluationTakeComponent_table_6_span_24_Template, 3, 3, \"span\", 10);\n    i0.ɵɵtext(25, \"\\u00A0 \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(26, \"tr\")(27, \"td\", 8);\n    i0.ɵɵtemplate(28, EvaluationTakeComponent_table_6_span_28_Template, 3, 3, \"span\", 10);\n    i0.ɵɵtext(29, \"\\u00A0 \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(30, \"tr\")(31, \"td\", 8);\n    i0.ɵɵtemplate(32, EvaluationTakeComponent_table_6_span_32_Template, 3, 3, \"span\", 10);\n    i0.ɵɵtext(33, \"\\u00A0 \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(34, \"tr\")(35, \"td\", 8);\n    i0.ɵɵtext(36, \"\\u00A0\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(37, \"tr\")(38, \"td\", 11)(39, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function EvaluationTakeComponent_table_6_Template_button_click_39_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r25 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r25.prev());\n    });\n    i0.ɵɵtext(40, \"Prev\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(41, \" | \");\n    i0.ɵɵelementStart(42, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function EvaluationTakeComponent_table_6_Template_button_click_42_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r26 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r26.next());\n    });\n    i0.ɵɵtext(43, \"Next\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(44, EvaluationTakeComponent_table_6_td_44_Template, 4, 1, \"td\", 13);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.eval.description);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"countdown\", ctx_r0.countdown);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" || Question \", ctx_r0.idx + 1, \" of \", ctx_r0.count, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.question.questionText);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.ans)(\"value\", 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.question.answerTextA, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.ans)(\"value\", 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.question.answerTextB, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.eval.questions[ctx_r0.idx].answerTextC.length > 0);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.eval.questions[ctx_r0.idx].answerTextD.length > 0);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.eval.questions[ctx_r0.idx].answerTextE.length > 0);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.isFirst);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.isLast);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.canComplete);\n  }\n}\n\nexport let EvaluationTakeComponent = /*#__PURE__*/(() => {\n  class EvaluationTakeComponent extends BcmsComponent {\n    constructor(sys, route, router, evalsvc, questsvc) {\n      super(sys);\n      this.sys = sys;\n      this.route = route;\n      this.router = router;\n      this.evalsvc = evalsvc;\n      this.questsvc = questsvc;\n      this.eval = new Evaluation();\n      this.quests = [];\n      this.idx = 0;\n      this.count = 0;\n      this.isFirst = true;\n      this.isLast = false;\n      this.canComplete = false;\n      this.answeredQuestions = 0;\n      this.verifyDone = false;\n      this.pageTitle = \"Evaluation Take\";\n    }\n\n    get ans() {\n      return this.eval.questions[this.idx].userAnswerNbr;\n    }\n\n    set ans(res) {\n      this.eval.questions[this.idx].userAnswerNbr = Number(res);\n    }\n\n    registerAnswer(answer) {\n      this.ans = answer;\n      this.saveQuest();\n    }\n\n    handleTimerExpiredEvent() {\n      console.warn(\"Timer expired!\");\n      this.done();\n    }\n\n    countAnsweredQuestions() {\n      let sum = 0;\n\n      for (let q of this.eval.questions) {\n        if (q.userAnswerNbr !== -1) {\n          sum++;\n        }\n      }\n\n      if (this.eval.questions.length === sum) {\n        this.canComplete = true;\n      }\n    }\n\n    calcTotalPoints(qs) {\n      let total = 0;\n      qs.forEach(q => {\n        if (q.correctAnswerNbr === q.userAnswerNbr) {\n          total += q.pointValue;\n        }\n      });\n      return total;\n    }\n\n    done() {\n      this.eval.isDone = true;\n      this.eval.pointsScored = this.calcTotalPoints(this.eval.questions); // this.eval.questions = null;\n\n      this.evalsvc.change(this.eval).subscribe(res => {\n        this.saveQuest();\n        this.sys.log.debug(\"Successful update of evaluation:\", res);\n        this.router.navigateByUrl(\"/evals/stud/list\");\n      }, err => {\n        this.sys.log.err(\"Failed update of evaluation:\", this.eval, err);\n      });\n    }\n\n    saveQuest() {\n      this.saveQuestion(this.eval.questions[this.idx]).subscribe(res => {\n        this.sys.log.debug(\"Successfully updated question:\", res);\n        this.countAnsweredQuestions();\n      }, err => {\n        this.sys.log.err(\"Failed to update question:\", this.question, err);\n      });\n    }\n\n    prev() {\n      this.prevQuestion();\n    }\n\n    next() {\n      this.nextQuestion();\n    }\n\n    nextQuestion() {\n      if (this.idx < this.quests.length - 1) {\n        this.idx++;\n        this.question = this.quests[this.idx];\n      }\n\n      this.isFirst = this.idx == 0;\n      this.isLast = this.idx == this.count - 1;\n    }\n\n    prevQuestion() {\n      if (this.idx > 0) {\n        this.idx--;\n        this.question = this.quests[this.idx];\n      }\n\n      this.isFirst = this.idx == 0;\n      this.isLast = this.idx == this.count - 1;\n    }\n\n    saveQuestion(q) {\n      return this.questsvc.change(q);\n    }\n\n    finished() {\n      this.verifyDone = !this.verifyDone;\n    }\n\n    refresh() {\n      this.evalsvc.get(this.evalId).subscribe(res => {\n        this.eval = res;\n        this.quests = this.eval.questions;\n        this.count = this.quests.length;\n        this.question = this.quests[0];\n        this.countdown = `${this.eval.timeLimitMinutes}:${this.eval.timeLimitSeconds}`;\n        this.sys.log.debug(\"Evaluation:\", res, this.evalId);\n        this.countAnsweredQuestions();\n      }, err => {\n        this.sys.log.err(\"Failed to read the evaluation:\", err, this.evalId);\n      });\n    }\n\n    ngOnInit() {\n      super.ngOnInit();\n      this.evalId = this.route.snapshot.params.id;\n      this.refresh(); // this.evalsvc.get(this.evalId).subscribe(\n      //   (res: Evaluation) => {\n      //     this.eval = res;\n      //     this.quests = this.eval.questions;\n      //     this.count = this.quests.length;\n      //     this.question = this.quests[0];\n      //     this.sys.log.debug(\"Evaluation:\", res, this.evalId);\n      //   },\n      //   err => {\n      //     this.sys.log.err(\"Failed to read the evaluation:\", err, this.evalId);\n      //   }\n      // );\n    }\n\n  }\n\n  EvaluationTakeComponent.ɵfac = function EvaluationTakeComponent_Factory(t) {\n    return new (t || EvaluationTakeComponent)(i0.ɵɵdirectiveInject(i1.SystemService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.EvaluationService), i0.ɵɵdirectiveInject(i4.QuestionService));\n  };\n\n  EvaluationTakeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EvaluationTakeComponent,\n    selectors: [[\"app-evaluation-take\"]],\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 9,\n    vars: 2,\n    consts: [[1, \"component-content\"], [\"class\", \"table table-borderless table-sm\", 4, \"ngIf\"], [1, \"table\", \"table-borderless\", \"table-sm\"], [1, \"text-uppercase\", \"category\"], [1, \"text-italics\", \"text-right\"], [1, \"font-weight-bold\"], [1, \"font-weight-bold\", \"text-danger\", 3, \"countdown\", \"timerExpiredEvent\"], [\"colspan\", \"2\", 1, \"font-italic\", \"question\"], [\"colspan\", \"2\"], [\"type\", \"radio\", \"name\", \"answer\", 3, \"ngModel\", \"value\", \"ngModelChange\", \"click\"], [4, \"ngIf\"], [1, \"\"], [1, \"btn\", \"btn-primary\", \"btn-sm\", 3, \"disabled\", \"click\"], [\"class\", \"text-right\", 4, \"ngIf\"], [1, \"text-right\"], [1, \"btn\", \"btn-warning\", \"btn-sm\", 3, \"click\"], [1, \"btn\", \"btn-danger\", \"btn-sm\", 3, \"click\"]],\n    template: function EvaluationTakeComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-menu\")(1, \"header\");\n        i0.ɵɵelementStart(2, \"div\")(3, \"span\");\n        i0.ɵɵtext(4);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"main\", 0);\n        i0.ɵɵtemplate(6, EvaluationTakeComponent_table_6_Template, 45, 17, \"table\", 1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"footer\");\n        i0.ɵɵelement(8, \"app-footer\");\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.pageTitle);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.question);\n      }\n    },\n    dependencies: [i5.DefaultValueAccessor, i5.RadioControlValueAccessor, i5.NgControlStatus, i5.NgModel, i6.NgIf, i7.FooterComponent, i8.MenuComponent, i9.DsiCountdownTimerComponent],\n    styles: [\"table[_ngcontent-%COMP%]{min-height:400px}button[_ngcontent-%COMP%]{text-align:left}.category[_ngcontent-%COMP%]{font-size:1.5rem}.question[_ngcontent-%COMP%]{font-size:1.2rem}.width60[_ngcontent-%COMP%]{width:60%}\"]\n  });\n  return EvaluationTakeComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}