{"ast":null,"code":"import { BcmsComponent } from '@feat/common/bcms.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@system/system.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@feat/config/config.service\";\nimport * as i4 from \"@attendance/attendance.service\";\nimport * as i5 from \"@angular/common\";\n\nfunction AttendanceStudentComponent_button_0_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r1.attnd.note);\n  }\n}\n\nfunction AttendanceStudentComponent_button_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 1);\n    i0.ɵɵlistener(\"click\", function AttendanceStudentComponent_button_0_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.showPinCode(ctx_r2.student.id));\n    });\n    i0.ɵɵelementStart(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 2);\n    i0.ɵɵtext(4, \"\\u00A0\");\n    i0.ɵɵtemplate(5, AttendanceStudentComponent_button_0_span_5_Template, 2, 1, \"span\", 3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", ctx_r0.buttonClasses);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.student.firstname, \" \", ctx_r0.student.lastname.substr(0, 1), \".\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.attnd);\n  }\n}\n\nexport let AttendanceStudentComponent = /*#__PURE__*/(() => {\n  class AttendanceStudentComponent extends BcmsComponent {\n    constructor(sys, router, cfgsvc, attendsvc) {\n      super(sys);\n      this.sys = sys;\n      this.router = router;\n      this.cfgsvc = cfgsvc;\n      this.attendsvc = attendsvc;\n      this.checkedInStyle = \"btn btn-lg btn-success\";\n      this.checkedInLateStyle = \"btn btn-lg btn-warning\";\n      this.checkedOutStyle = \"btn btn-lg btn-secondary\";\n      this.buttonClasses = this.checkedOutStyle;\n      this.attnd = null;\n      this.checkedIn = false;\n      this.lateHour = 0;\n      this.lateMinute = 0;\n    }\n\n    showPinCode(studentId) {\n      this.router.navigateByUrl(`/attendance/pincode/${studentId}/${this.cohortId}/${this.checkedIn}`);\n    } // check whther the student is late\n\n\n    isCheckinLate(checkin) {\n      let chkin = new Date(Date.parse(checkin));\n      let late = new Date(Date());\n      late.setHours(this.lateHour, this.lateMinute, 0);\n      let isLate = chkin > late;\n      this.setNoteWithCheckinTime(chkin);\n      return isLate;\n    }\n\n    setNoteWithCheckinTime(chkin) {\n      let time = chkin.toLocaleTimeString(); // to [1:23 AM] or [11:34 PM]\n\n      let displayTime = time.length == 11 ? time.substr(0, 5) : time.substr(0, 4); // [1:23] or [11:34]\n\n      displayTime += time.substr(-2, 1).toLowerCase(); // to [1:23a] or [11:34p]\n\n      if (this.attnd.note == null) this.attnd.note = \"\"; // make sure note is not null\n\n      this.attnd.note += ` [${displayTime}] `;\n    }\n\n    setBlockColor(checkInTime) {\n      let checkedInLate = this.isCheckinLate(checkInTime);\n      this.buttonClasses = checkedInLate ? this.checkedInLateStyle : this.checkedInStyle;\n    }\n\n    isCheckedIn(studentId) {\n      this.buttonClasses = this.checkedOutStyle; // set color to checked-out\n\n      this.attendsvc.ischeckedin(this.cohortId, studentId).subscribe(res => {\n        this.attnd = res;\n        this.sys.log.debug(\"Attendance:\", this.attnd);\n        this.checkedIn = res != null;\n\n        if (this.checkedIn) {\n          let checkInTime = this.attnd != null ? this.attnd.in : null;\n          this.setBlockColor(checkInTime);\n        }\n      }, err => {\n        this.sys.log.err(\"Exception:\", err);\n      });\n    }\n\n    ngOnInit() {\n      super.ngOnInit(); // get late hour and minute\n\n      this.cfgsvc.getKeys(\"late.hour,late.minute\").subscribe(res => {\n        this.lateHour = Number(res[0].dataValue);\n        this.lateMinute = Number(res[1].dataValue); // see if user is checked in already\n\n        this.isCheckedIn(this.student.id);\n      }, err => {\n        this.sys.log.err(\"Error attendance-student.ngOnInit:\", err);\n      });\n    }\n\n  }\n\n  AttendanceStudentComponent.ɵfac = function AttendanceStudentComponent_Factory(t) {\n    return new (t || AttendanceStudentComponent)(i0.ɵɵdirectiveInject(i1.SystemService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.ConfigService), i0.ɵɵdirectiveInject(i4.AttendanceService));\n  };\n\n  AttendanceStudentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AttendanceStudentComponent,\n    selectors: [[\"app-attendance-student\"]],\n    inputs: {\n      student: \"student\",\n      cohortId: \"cohortId\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 1,\n    vars: 1,\n    consts: [[3, \"ngClass\", \"click\", 4, \"ngIf\"], [3, \"ngClass\", \"click\"], [1, \"note\"], [4, \"ngIf\"]],\n    template: function AttendanceStudentComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, AttendanceStudentComponent_button_0_Template, 6, 4, \"button\", 0);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.student);\n      }\n    },\n    dependencies: [i5.NgClass, i5.NgIf],\n    styles: [\"button[_ngcontent-%COMP%]{margin:20px 30px;width:200px;height:100px;font-size:1.3rem}.note[_ngcontent-%COMP%]{font-size:.8rem}\"]\n  });\n  return AttendanceStudentComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}